<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/markdown/index.md.vm at 2020-03-23
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200323" />
    <meta http-equiv="Content-Language" content="en" />
    <title>finmath-lib-cuda-extensions &#x2013; finmath lib cuda extensions</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarEnabled">
    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">finmath lib cuda extensions <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="Introduction">Introduction</a></li>
            <li><a href="apidocs" title="API Documentation">API Documentation</a></li>
            <li><a href="releasenotes.html" title="Release Notes">Release Notes</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="summary.html" title="Summary">Summary</a></li>
                  <li><a href="scm.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="dependency-info.html" title="Dependency Information">Dependency Information</a></li>
                  <li><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="issue-management.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="licenses.html" title="Licenses">Licenses</a></li>
                  <li><a href="team.html" title="Team">Team</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="apidocs/index.html" title="Javadoc">Javadoc</a></li>
                  <li><a href="testapidocs/index.html" title="Test Javadoc">Test Javadoc</a></li>
                  <li><a href="surefire-report.html" title="Surefire Report">Surefire Report</a></li>
                  <li><a href="checkstyle.html" title="Checkstyle">Checkstyle</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
            <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
    <li><a href="http://www.finmath.net/" title="finmath.net">finmath.net</a></li>
                </ul>
              </li>
            </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="http://www.finmath.net/finmath-lib-cuda-extensions" id="bannerLeft"><h2>finmath lib cuda extensions</h2>
</a></div>
        <div class="pull-right"><a href="http://www.finmath.net" id="bannerRight"><img src="http://www.finmath.net/artwork/logo.png"  alt="finmath.net" width="60"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2020-03-23<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 4.1.7</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">finmath lib cuda extensions</li>
    <li class="active"><a href="#"><span class="none"></span>Introduction</a></li>
    <li><a href="apidocs" title="API Documentation"><span class="none"></span>API Documentation</a></li>
    <li><a href="releasenotes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="finmath.net/finmath-lib-cuda-extensions" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
    <div id="twitter">
    <a href="https://twitter.com/finmathnet" class="twitter-follow-button" data-show-count="false" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow finmathnet</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>finmath lib cuda extensions</h1><hr />
<p><b>Vector class (RandomVariable) running on GPUs (Cuda and OpenCL).</b></p>
<p><b>Enabling finmath lib with Cuda (via jcuda) and OpenCL (via jocl). - Running finmath lib models on a GPU.</b></p><hr />
<p>The <i>finmath lib cuda extensions</i> provide a <b>Cuda</b> and <b>OpenCL</b> implementation of the <a class="externalLink" href="http://finmath.net/finmath-lib/">finmath lib</a> interfaces RandomVariable and BrownianMotion compatible with finmath lib 4.0.12 or later (tested on GRID GPU Kepler GK105, GeForce GTX 1080, GeForce GT 750M (Cuda and OpenCL) and ATI Radeon Pro 560 (OpenCL only)).</p><section><section>
<h3><a name="RandomVariable"></a>RandomVariable</h3>
<p>A RandomVariableCudaFactory is provided, which can be injected in any finmath lib model/algorithm using a random variable factory to construct RandomVariable objects. Objects created from this factory or from objects created from this factory perform their calculation on the GPU.</p>
<p>The implementation supports type priorities (see <a class="externalLink" href="http://ssrn.com/abstract=3246127">http://ssrn.com/abstract=3246127</a> ) and the default priority of RandomVariableCuda is 20. For example: operators involving CPU and GPU vectors will result in GPU vectors.</p>
<p>The RandomVariableCudaFactory can be combined with <i>algorithmic differentiation</i> AAD wrappers, for example RandomVariableDifferentiableAAD, to allow algorithmic differentiation together with calculations performed on the GPU. For the type priority: objects allowing for algorithmic differentiation (AAD) have higher priority, AAD on GPU has higher priority than AAD on CPU.</p>
<p>For OpenCL you may use RandomVariableOpenCLFactory and RandomVariableOpenCL respectively</p></section><section>
<h3><a name="BrownianMotion"></a>BrownianMotion</h3>
<p>In addition, objects of type BrownianMotion are also taking the role of a factory for objects of type RandomVariable. Thus, injecting the BrownianMotionCuda into classes consuming a BrownianMotion will result in finmath-lib models performing their calculations on the GPU - seamlessly.</p></section></section><section>
<h2><a name="Distribution"></a>Distribution</h2>
<p>finmath-lib-cuda-extensions is distributed through the central Maven repository. It&#x2019;s coordinates are:</p>

<div>
<div>
<pre class="source">&lt;groupId&gt;net.finmath&lt;/groupId&gt;
&lt;artifactId&gt;finmath-lib-cuda-extensions&lt;/artifactId&gt;
&lt;version&gt;4.1.7&lt;/version&gt;
</pre></div></div>

<p>The project is currently build for Cuda 10.1 and OpenCL 2.0. For other Cuda versions use the Maven command line property cuda.version set to one of 8.0, 9.2, 10.0, 10.1 and the Maven classifyer cuda-${cuda.version}.</p></section><section>
<h2><a name="Example"></a>Example</h2>
<p>Create a vector of floats on the GPU device</p>

<div>
<div>
<pre class="source">RandomVariableInterface randomVariable = new RandomVariableCuda(new float[] {-4.0f, -2.0f, 0.0f, 2.0f, 4.0f} );
</pre></div></div>

<p>perform some calculations (still on the GPU device)</p>

<div>
<div>
<pre class="source">randomVariable = randomVariable.add(4.0);
randomVariable = randomVariable.div(2.0);
</pre></div></div>

<p>perform a reduction on the GPU device</p>

<div>
<div>
<pre class="source">double average = randomVariable.getAverage();
</pre></div></div>

<p>or get the result vector (to the host)</p>

<div>
<div>
<pre class="source">double[] result = randomVariable.getRealizations();
</pre></div></div>

<p>(note: the result is always double, since different implementation may support float or double on the device).</p></section><section>
<h2><a name="Installation_.2F_Build"></a>Installation / Build</h2>
<p>Binary distribution is available via Maven central.</p>
<p>You have to have NVIDIA Cuda 10.1 installed. The Maven configuration comes with profiles for Cuda 8.0, 9.2, 10.0 and 10.1. If you like to use a different version, you can try to switch the JCuda version by setting the property cuda.version on the Maven command line.</p>
<p>To build the project yourself and run the unit tests from the source repository:</p>
<p>Obtain the finmath-lib-cuda-extensions source</p>

<div>
<div>
<pre class="source">git clone https://github.com/finmath/finmath-lib-cuda-extensions.git
cd finmath-lib-cuda-extensions
</pre></div></div>

<p>&#x2026;then build the code.</p>

<div>
<div>
<pre class="source">mvn clean package
</pre></div></div>

<p>This will build the version using Cuda 10.1. For Cuda 10.0 use</p>

<div>
<div>
<pre class="source">mvn -Dcuda.version=10.0 clean package
</pre></div></div>

<p>If everything goes well, you will see unit test run. Note that some of the tests may fail if the device (GPU) has not enough memory.</p></section><section>
<h2><a name="Trying_on_Amazon_EC2"></a>Trying on Amazon EC2</h2>
<p>If you do not have a machine with NVidia Cuda 10.0 at hand, you may try out the finmath-lib-cuda-extensions on an Amazon EC2 machine. To do so:</p>
<ul>

<li>Create an Amazon AWS account (if needed) an go to your AWS console.</li>
<li>Select to start an EC2 virtual server.</li>
<li>Launch a GPU instance</li>
<li>Filter the list of images (AMI) using gpu and select - e.g. - Deep Learning Base AMI (Ubuntu) Version 19.0.</li>
<li>Filter the list of servers using the &#x201c;GPU instances&#x201d; and select an instance.</li>
<li>Login to your GPU instance.</li>
<li>Check that you have cuda 10.0 (e.g. use nvcc --version)</li>
<li>Try finmath-lib-cuda-extensions as described in the previous section.</li>
</ul></section><section>
<h2><a name="Performance"></a>Performance</h2><section>
<h3><a name="Unit_test_for_random_number_generation:"></a>Unit test for random number generation:</h3>

<div>
<div>
<pre class="source">Running net.finmath.montecarlo.BrownianMotionTest
Test of performance of BrownianMotionLazyInit                  	..........test took 49.057 sec.
Test of performance of BrownianMotionJavaRandom                	..........test took 65.558 sec.
Test of performance of BrownianMotionCudaWithHostRandomVariable	..........test took 4.633 sec.
Test of performance of BrownianMotionCudaWithRandomVariableCuda	..........test took 2.325 sec.
</pre></div></div>
</section><section>
<h3><a name="Unit_test_for_Monte-Carlo_simulation"></a>Unit test for Monte-Carlo simulation</h3>

<div>
<div>
<pre class="source">Running net.finmath.montecarlo.assetderivativevaluation.MonteCarloBlackScholesModelTest
BrownianMotionLazyInit                    calculation time =  4.00 sec   value Monte-Carlo =  0.1898	 value analytic    =  0.1899.
BrownianMotionJavaRandom                  calculation time =  5.19 sec   value Monte-Carlo =  0.1901	 value analytic    =  0.1899	.
BrownianMotionCudaWithHostRandomVariable  calculation time =  2.50 sec   value Monte-Carlo =  0.1898	 value analytic    =  0.1899.
BrownianMotionCudaWithRandomVariableCuda  calculation time =  0.09 sec   value Monte-Carlo =  0.1898	 value analytic    =  0.1899	.
</pre></div></div>

<p>Remark: * BrownianMotionLazyInit: Calculation on CPU, using Mersenne Twister. * BrownianMotionJavaRandom: Calculation on CPU, using Java random number generator (LCG). * BrownianMotionCudaWithHostRandomVariable: Calculation on CPU and GPU: Random number generator on GPU, Simulation on CPU. * BrownianMotionCudaWithRandomVariableCuda: Calculation on GPU: Random number generator on GPU, Simulation on GPU.</p></section><section>
<h3><a name="Unit_test_for_LIBOR_Market_Model_calibration"></a>Unit test for LIBOR Market Model calibration</h3>
<p>There is also a unit test performing a brute force Monte-Carlo calibration of a LIBOR Market Model with stochastic volatility on the CPU and the GPU. Note however that the unit test uses a too small size for the number of simulation paths, such that the GPU code is no improvement over the CPU code. The unit test shows that CPU and GPU give consistent results.</p>
<p>The performance of a brute-force Monte-Carlo calibration with 80K and 160K paths are given below. Note: if the number of paths is increased, the GPU time remains almost the same (given that the GPU has sufficient memory), while the CPU time grows linearly. This is due to the fact that the GPU performance has a large part of fixed management overhead (which will be reduced in future versions).</p>
<p>The CPU version was run on a an Intel i7-7800X 3.5 GHz using multi-threadded calibration. THe GPU version was run on an nVidia GeForce GTX 1080.</p><section>
<h4><a name="LMM_with_81.2C920_paths"></a>LMM with 81,920 paths</h4>

<div>
<div>
<pre class="source">Running net.finmath.montecarlo.interestrates.LIBORMarketModelCalibrationTest

Calibration to Swaptions using CPU    calculation time = 364.42 sec    RMS Error.....: 0.198%.
Calibration to Swaptions using GPU    calculation time =  49.46 sec    RMS Error.....: 0.198%.
</pre></div></div>

<p>(LIBOR Market Model with stochastic volatility, 6 factors, 81920 paths)</p></section><section>
<h4><a name="LMM_with_163.2C840_paths"></a>LMM with 163,840 paths</h4>

<div>
<div>
<pre class="source">Running net.finmath.montecarlo.interestrates.LIBORMarketModelCalibrationTest

Calibration to Swaptions using CPU    calculation time = 719.33 sec    RMS Error.....: 0.480%.
Calibration to Swaptions using GPU    calculation time =  51.70 sec    RMS Error.....: 0.480%.
</pre></div></div>

<p>(LIBOR Market Model with stochastic volatility, 6 factors, 163840 paths)</p></section></section></section><section>
<h2><a name="Profiles_for_Other_Cuda_Versions"></a>Profiles for Other Cuda Versions</h2>
<p>The default profile will build the version using Cuda 10.1.</p><section><section>
<h4><a name="Cuda_10.0"></a>Cuda 10.0</h4>
<p>For Cuda 10.0 use</p>

<div>
<div>
<pre class="source">mvn -Pcuda-10.0 clean package
</pre></div></div>

<p>or</p>

<div>
<div>
<pre class="source">mvn -Dcuda.version=10.0 clean package
</pre></div></div>
</section><section>
<h4><a name="Cuda_9.2"></a>Cuda 9.2</h4>
<p>For Cuda 9.2 use</p>

<div>
<div>
<pre class="source">mvn -Pcuda-9.2 clean package
</pre></div></div>

<p>or</p>

<div>
<div>
<pre class="source">mvn -Dcuda.version=9.2 clean package
</pre></div></div>
</section><section>
<h4><a name="Cuda_8.0"></a>Cuda 8.0</h4>
<p>For Cuda 8.0 use</p>

<div>
<div>
<pre class="source">mvn -P cuda-8.0 clean package
</pre></div></div>

<p>or</p>

<div>
<div>
<pre class="source">mvn -Dcuda.version=8.0 clean package
</pre></div></div>
</section><section>
<h4><a name="Cuda_6.0"></a>Cuda 6.0</h4>
<p>For Cuda 6.0 use</p>

<div>
<div>
<pre class="source">mvn -P cuda-6.0 clean package
</pre></div></div>

<p>or</p>

<div>
<div>
<pre class="source">mvn -Dcuda.version=6.0 clean package
</pre></div></div>

<p>For Cuda 6.0 the jcuda binaries are not unpacked automatically and have to be installed manually. Set LD_LIBRARY_PATH (*nix environment variable) or java.library.path (Java system property) to the jcuda platform specific binaries.</p></section></section></section><section>
<h2><a name="References"></a>References</h2>
<ul>

<li><a class="externalLink" href="http://finmath.net/finmath-lib/">finmath lib Project documentation</a> provides the documentation of the library api.</li>
<li><a class="externalLink" href="http://finmath.net/finmath-lib/apidocs/">finmath lib API documentation</a> provides the documentation of the library api.</li>
<li><a class="externalLink" href="http://www.finmath.net/topics">finmath.net special topics</a> cover some selected topics with demo spreadsheets and uml diagrams. Some topics come with additional documentations (technical papers).</li>
</ul></section><section>
<h2><a name="License"></a>License</h2>
<p>The code of &#x201c;finmath lib&#x201d;, &#x201c;finmath experiments&#x201d; and &#x201c;finmath lib cuda extensions&#x201d; (packages net.finmath.*) are distributed under the <a class="externalLink" href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License version 2.0</a>, unless otherwise explicitly stated.</p></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2020
<a href="http://finmath.net">finmath.net</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>